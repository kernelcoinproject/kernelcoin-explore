{{define "transaction.html"}}
<div class="row mb-4">
  <div class="col-12">
    <h2 style="color: var(--primary); margin-bottom: 1.5rem;">
      <i class="fas fa-exchange-alt"></i> Transaction Details
    </h2>
  </div>
</div>

{{if .Transaction}}
<div class="row mb-4">
  <div class="col-lg-6">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title" style="color: var(--primary);">
          <i class="fas fa-info-circle"></i> Transaction Information
        </h5>
        <div class="mt-3">
          <div class="mb-3">
            <label class="form-label" style="color: var(--text-secondary); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px;">TXID</label>
            <div style="background: rgba(0, 0, 0, 0.3); border: 1px solid var(--border-color); padding: 1rem; border-radius: 6px; font-family: 'Courier New', monospace; font-size: 0.85rem; word-break: break-all; color: var(--secondary);">
              {{.Transaction.TxID}}
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label" style="color: var(--text-secondary); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px;">Version</label>
            <div style="color: var(--text-primary);">{{.Transaction.Version}}</div>
          </div>
          <div class="mb-3">
            <label class="form-label" style="color: var(--text-secondary); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px;">Size</label>
            <div style="color: var(--text-primary);">{{.Transaction.Size}} bytes</div>
          </div>
          <div class="mb-3">
            <label class="form-label" style="color: var(--text-secondary); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px;">Virtual Size (vsize)</label>
            <div style="color: var(--text-primary);">{{.Transaction.Vsize}} vB</div>
          </div>
          <div class="mb-3">
            <label class="form-label" style="color: var(--text-secondary); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px;">Weight</label>
            <div style="color: var(--text-primary);">{{.Transaction.Weight}} WU</div>
          </div>
          <div class="mb-3">
            <label class="form-label" style="color: var(--text-secondary); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px;">Locktime</label>
            <div style="color: var(--text-primary);">{{.Transaction.Locktime}}</div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-lg-6">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title" style="color: var(--primary);">
          <i class="fas fa-cube"></i> Block Information
        </h5>
        <div class="mt-3">
          {{if .Transaction.Blockhash}}
          <div class="mb-3">
            <label class="form-label" style="color: var(--text-secondary); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px;">Block Hash</label>
            <div style="background: rgba(0, 0, 0, 0.3); border: 1px solid var(--border-color); padding: 1rem; border-radius: 6px; font-family: 'Courier New', monospace; font-size: 0.85rem; word-break: break-all; color: var(--secondary);">
              <a href="/explorer/?block={{.Transaction.Blockhash}}" style="color: var(--primary);">{{.Transaction.Blockhash}}</a>
            </div>
          </div>
          {{end}}
          {{if .Transaction.Blocktime}}
          <div class="mb-3">
            <label class="form-label" style="color: var(--text-secondary); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px;">Block Time</label>
            <div style="color: var(--text-primary);">{{.Transaction.Blocktime}}</div>
          </div>
          {{end}}
          {{if .Transaction.Confirmations}}
          <div class="mb-3">
            <label class="form-label" style="color: var(--text-secondary); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px;">Confirmations</label>
            <div style="color: var(--text-primary);">{{.Transaction.Confirmations}}</div>
          </div>
          {{end}}
          {{if .Transaction.Time}}
          <div class="mb-3">
            <label class="form-label" style="color: var(--text-secondary); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px;">Time</label>
            <div style="color: var(--text-primary);">{{.Transaction.Time}}</div>
          </div>
          {{end}}
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row mb-4">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title" style="color: var(--primary);">
          <i class="fas fa-arrow-right"></i> Inputs ({{len .Transaction.Vin}})
        </h5>
        <div class="table-responsive mt-3">
          <table class="table table-bordered table-hover table-striped">
            <thead class="table-dark">
              <tr>
                <th style="color: #fff;">Previous TXID</th>
                <th style="color: #fff;">Vout</th>
                <th style="color: #fff;">Sequence</th>
              </tr>
            </thead>
            <tbody>
              {{range .Transaction.Vin}}
              <tr>
                <td style="color: var(--text-primary);">
                  {{if .TXID}}
                  <a href="/explorer/?tx={{.TXID}}" style="color: var(--primary);">{{.TXID}}</a>
                  {{else}}
                  <span style="color: var(--text-secondary);">Coinbase</span>
                  {{end}}
                </td>
                <td style="color: var(--text-primary);">{{.Vout}}</td>
                <td style="color: var(--text-primary);">{{.Sequence}}</td>
              </tr>
              {{end}}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row mb-4">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title" style="color: var(--primary);">
          <i class="fas fa-arrow-left"></i> Outputs ({{len .Transaction.Vout}})
        </h5>
        <div class="table-responsive mt-3">
          <table class="table table-bordered table-hover table-striped">
            <thead class="table-dark">
              <tr>
                <th style="color: #fff;">Index</th>
                <th style="color: #fff;">Amount</th>
                <th style="color: #fff;">Address</th>
                <th style="color: #fff;">Type</th>
              </tr>
            </thead>
            <tbody>
              {{range .Transaction.Vout}}
              <tr>
                <td style="color: var(--text-primary);">{{.N}}</td>
                <td style="color: var(--text-primary);">{{printf "%.8f" .Value}} KCN</td>
                <td style="color: var(--text-primary);">
                  {{if .ScriptPubKey.Address}}
                  <a href="/explorer/?search={{.ScriptPubKey.Address}}" style="color: var(--primary);">{{.ScriptPubKey.Address}}</a>
                  {{else}}
                  <span style="color: var(--text-secondary);">N/A</span>
                  {{end}}
                </td>
                <td style="color: var(--text-primary);">{{.ScriptPubKey.Type}}</td>
              </tr>
              {{end}}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row mb-4">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title" style="color: var(--primary);">
          <i class="fas fa-cube"></i> OP_RETURN Data
        </h5>
        <div class="mt-3">
          {{$hasOpReturn := false}}
          {{range .Transaction.Vout}}
            {{if eq .ScriptPubKey.Type "nulldata"}}
              {{$hasOpReturn = true}}
              <div class="mb-4">
                <label class="form-label" style="color: var(--text-secondary); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px;">Output {{.N}} - Hex</label>
                <div style="background: rgba(0, 0, 0, 0.3); border: 1px solid var(--border-color); padding: 1rem; border-radius: 6px; font-family: 'Courier New', monospace; font-size: 0.8rem; word-break: break-all; color: var(--secondary); max-height: 150px; overflow-y: auto;">
                  {{.ScriptPubKey.Hex}}
                </div>
              </div>
            {{end}}
          {{end}}
          {{if not $hasOpReturn}}
          <p style="color: var(--text-secondary);">No OP_RETURN data found in this transaction.</p>
          {{end}}
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row mb-4">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title" style="color: var(--primary);">
          <i class="fas fa-cube"></i> Coinbase Information
        </h5>
        <div class="mt-3">
          {{if eq (len .Transaction.Vin) 1}}
            {{$firstInput := index .Transaction.Vin 0}}
            {{if not $firstInput.TXID}}
            <div class="mb-3">
              <label class="form-label" style="color: var(--text-secondary); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px;">Coinbase Script (Hex)</label>
              <div style="background: rgba(0, 0, 0, 0.3); border: 1px solid var(--border-color); padding: 1rem; border-radius: 6px; font-family: 'Courier New', monospace; font-size: 0.8rem; word-break: break-all; color: var(--secondary); max-height: 150px; overflow-y: auto;">
                {{$firstInput.ScriptSig.Hex}}
              </div>
            </div>
            {{else}}
            <p style="color: var(--text-secondary);">This is not a coinbase transaction.</p>
            {{end}}
          {{else}}
          <p style="color: var(--text-secondary);">This is not a coinbase transaction.</p>
          {{end}}
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row mb-4">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title" style="color: var(--primary);">
          <i class="fas fa-code"></i> Raw Transaction Hex
        </h5>
        <div style="background: rgba(0, 0, 0, 0.3); border: 1px solid var(--border-color); padding: 1rem; border-radius: 6px; font-family: 'Courier New', monospace; font-size: 0.75rem; word-break: break-all; color: var(--secondary); max-height: 300px; overflow-y: auto;">
          {{.Transaction.Hex}}
        </div>
      </div>
    </div>
  </div>
</div>

{{else}}
<div class="row mb-4">
  <div class="col-12">
    <div style="background: rgba(255, 68, 68, 0.1); border: 2px solid var(--error); border-radius: 12px; padding: 2rem; text-align: center;">
      <h4 style="color: var(--error); margin-bottom: 0.5rem;">
        <i class="fas fa-times-circle"></i> Transaction Not Found
      </h4>
      <p style="color: var(--text-secondary); margin-bottom: 1rem;">
        The transaction you searched for could not be found.
      </p>
      <a href="{{.HomeLink}}" class="btn btn-primary btn-sm">
        <i class="fas fa-home"></i> Back to Home
      </a>
    </div>
  </div>
</div>
{{end}}
{{end}}
